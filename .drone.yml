kind: pipeline
name: default

steps:
- name: lint
  image: golang
  commands:
    - curl -sfL https://install.goreleaser.com/github.com/golangci/golangci-lint.sh | sh -s -- -b $(go env GOPATH)/bin v1.16.0
    - golangci-lint run --enable-all
- name: seed
  image: mongo
  commands:
    - mongo --host database i1820 mongodb/data_collection_index.js
    - mongo --host database i1820 .ci/mongo.js
- name: test
  image: golang
  environment:
    I1820_DM_DATABASE_URL: "mongodb://database:27017"
  commands:
  - go build
  - go test -v ./...

services:
- name: database
  image: mongo:latest
